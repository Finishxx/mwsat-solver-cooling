# Maximal Weighted SAT solver

> Made as a part of homework to FIT CTU's combinatorial optimization class.
> The second part of the homework is accessible [here](https://github.com/Finishxx/mwsat-solver-fine-tuning) and was concerned with
> fine-tuning this solver and simulated annealing parameters to solve particular
> instances in reasonable time.

Uses simulated annealing (cooling) to solve [MWSAT](https://en.wikipedia.org/wiki/Maximum_satisfiability_problem).

Compile the project using `cmake` and run it with `--help` for this message:
```
$ main --help
Solves maximum weighted sat instances in the MWSAT format using simulated cooling method.

The result is printed in the format of <inputFileName> <weight> <variable1> <variable2> ... <variableN>
Usage: main [OPTIONS]

Options:
  -h,--help                   Print this help message and exit
  -f,--file TEXT REQUIRED     Path to instance in the MWSAT format
  -s,--seed TEXT REQUIRED     64-bit hex seed
  -t,--startTemperature FLOAT REQUIRED
  -T,--endTemperature FLOAT REQUIRED
  -c,--cooling FLOAT REQUIRED Cooling coefficient
  -e,--equilibrium UINT REQUIRED
  -d,--debug TEXT             Where to write <step> <satisfied> <weight> <bestWeight> on each line per step
  -i,--maxIterations UINT     Iterations before end, if 0 then infinite
  -w,--withoutGain UINT       End after steps without gain, if 0 then infinite
  -W,--withoutChange UINT     End after steps without change, if 0 then infinite
  -E,--extendedOutput BOOLEAN Show extended output after completion in the format of: 
                              First line is normal <fileName> <weight> <variable1> ... <variableN>. 
                              Second line is <endedBecause> <isSatisfied> <satisfiedCount> 
                              <stepsTotal> <stepsSinceChange> <stepsSinceGain>, 
                              where endedBecause is one of: temperature|max|change|gain|unknown
```

## Project structure

The goal was to use modern C++ - `CLI11` library and C++20's concepts and ranges.
Tried to decouple the simulated annealing from the MWSAT problem specifics as much as possible using the concepts, therefore
- **dimacs** module is used for parsing DIMACS input files
- **cooling** module implements the simulated annealing (cooling) algorithm using concepts
- **sat** module implements the **cooling**'s concepts to solve MWSAT problems
- **main** file puts it all together and provides a CLI interface

## Simulated annealing design
- **State Definition**  
  The state is represented as an assignment of values to all variables.
- **Initial State Selection**  
  The initial state is chosen randomly.
- **Neighbor Selection**  
  A neighbor is generated by randomly flipping the assignment of a single variable.
- **Relaxation Strategy**
    - If the current assignment does **not** satisfy the formula, we compare states based on the number of satisfied clauses, following the approach used in the unweighted MaxSat problem.
    - If the formula **is** satisfied, we compare the total weights.  
      This approach helps avoid getting stuck in local maxima that do not satisfy the formula.
- **The `howMuchWorse(a, b)` Function**  
  This function quantifies how much worse state `a` is compared to state `b`, with normalization for comparability:
    - **Both states satisfy the formula:**
  
      ![satisfied](img/satisfied.png)
    - **Neither state satisfies the formula:**
  
      ![unsatisfied](img/unsatisfied.png)
    - **Only one state (`a`) satisfies the formula:**
  
      ![satisfied-unsatisfied](img/satisfied-unsatisfied.png)
- **Additional parameters**
  - Equilibrium (number of iterations at a given temperature)
  - Cooling coefficient
  - Initial and final temperature
